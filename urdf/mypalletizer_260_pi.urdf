<?xml version="1.0"?>
<!--
<robot  xmlns:xacro="http://www.ros.org/wiki/xacro" name="firefighter" >
<xacro:property name="width" value=".2" />
-->
<robot name="myPalletizer">
  <link name="world"/>

  <link name="base">
    <visual>
      <geometry>
        <!--- 0.0 0 -0.04  1.5708 3.14159-->
        <mesh filename="base.dae"/>
        <!-- <cylinder length="0.01" radius="0.1"/> -->
      </geometry>
      <!-- <origin xyz = " 0 -0.28 0.051 " rpy = " 1.5707963 0 1.5707963"/> -->
      <origin xyz = " 0 0 0 " rpy = " 0 0 3.1415926"/>
    </visual>
    <collision>
      <geometry>
        <!--- 0.0 0 -0.04  1.5708 3.14159-->
        <!-- <mesh filename="base.dae"/> -->
        <cylinder length="0.01" radius="0.1"/>
      </geometry>
      <!-- <origin xyz = " 0 -0.28 0.051 " rpy = " 1.5707963 0 1.5707963"/> -->
      <origin xyz = " 0 0 -0.215 " rpy = " 0 0 3.1415926"/>
    </collision>
    <inertial>
      <mass value="1.0"/>
      <origin xyz = " 0 0 0 " rpy = " 0 0 3.1415926"/>
      <inertia ixx="0.0027" iyy="0.0027" izz="0.005" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <link name="link1">
    <visual>
      <geometry>
        <mesh filename="link1.dae"/>
	<!-- <cylinder length="0.01" radius="0.1"/> -->
      </geometry>
      <origin xyz = "0 -0.282  -0.115 " rpy = " 1.5707963 0 -1.5707963"/>
    </visual>
    <collision>
      <geometry>
	      <!-- <mesh filename="link1.dae"/> -->
        <cylinder length="0.115" radius="0.03"/>
      </geometry>
      <origin xyz = "0 -0.282  -0.115 " rpy = " 1.5707963 0 -1.5707963"/>
    </collision>
    <inertial>
      <mass value="1.0"/>
      <origin xyz = "0 -0.282  -0.115 " rpy = " 1.5707963 0 -1.5707963"/>
      <inertia ixx="0.0027" iyy="0.0027" izz="0.005" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <link name="link2">
    <visual>
      <geometry>    
        <mesh filename="link2.dae"/>
        <!-- <cylinder length="0.01" radius="0.1"/> -->
      </geometry>
      <origin xyz = "0  0.105 -0.414  " rpy = " 0 1.5707963 3.1415926"/>
    </visual>
    <collision>
      <geometry>    
        <!-- <mesh filename="link2.dae"/> -->
        <cylinder length="0.130" radius="0.03"/>
      </geometry>
      <origin xyz = "0  0.105 -0.414  " rpy = " 0 1.5707963 3.1415926"/>
    </collision>     
    <inertial>
      <mass value="1.0"/>
      <origin xyz = "0  0.105 -0.414  " rpy = " 0 1.5707963 3.1415926"/>
      <inertia ixx="0.0027" iyy="0.0027" izz="0.005" ixy="0" ixz="0" iyz="0"/>
    </inertial>

  </link>

  <link name="link3">
    <visual>
      <geometry>
       <!--- 0.0 0 -0.04 -->
        <mesh filename="link3.dae"/>
        <!-- <cylinder length="0.01" radius="0.1"/> -->
      </geometry>
      <origin xyz = "0 0.235  -0.325 " rpy = "0 1.5707963  3.1419626"/>
    </visual>
    <collision>
      <geometry>
        <!--- 0.0 0 -0.04 -->
        <mesh filename="link3.dae"/>
	<!-- <cylinder length="0.130" radius="0.03"/> -->
      </geometry>
      <origin xyz = "0 0.235  -0.325 " rpy = "0 1.5707963  3.1419626"/>
    </collision>
    <inertial>
      <mass value="1.0"/>
      <origin xyz = "0 0.235  -0.325 " rpy = "0 1.5707963  3.1419626"/>
      <inertia ixx="0.0027" iyy="0.0027" izz="0.005" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <link name="link4">
    <visual>
      <geometry>
        <!--- 0.0 0 -0.04 -->
	<mesh filename="link4.dae"/>
	<!-- <cylinder length="0.01" radius="0.1"/> -->
      </geometry>
      <origin xyz = "-0.12 -0.235  0.252" rpy = " 0 -1.5707963  0"/>
    </visual>
    <collision>
      <geometry>
        <!--- 0.0 0 -0.04 -->
        <!-- <mesh filename="link4.dae"/> -->
        <cylinder length="0.03412" radius="0.03"/>
      </geometry>
    <origin xyz = "-0.12 -0.235  0.252" rpy = " 0 -1.5707963  0"/>
    </collision>
    <inertial>
      <mass value="1.0"/>
      <origin xyz = "-0.12 -0.235  0.252" rpy = " 0 -1.5707963  0"/>
      <inertia ixx="0.0027" iyy="0.0027" izz="0.005" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <link name="link5">
    <visual>
      <geometry>
       <!--- 0.0 0 -0.04 -->
       <cylinder length="0.015" radius="0.0152"/>
        <!-- <mesh filename="package://mycobot_description/urdf/mypalletizer_260_pi/link5.dae"/> -->
      </geometry>
      <material name = "grey">
        <color rgba = "0.5 0.5 0.5 1"/>
      </material>
      <origin xyz = "0 -0.001 0.01 " rpy = " 0 0 0"/>
    </visual>
    <collision>
      <geometry>
       <!--- 0.0 0 -0.04 -->
       <cylinder length="0.015" radius="0.0152"/>
      </geometry>
      <origin xyz = "0 -0.001 0.01 " rpy = " 0 0 0"/>
    </collision>
    <inertial>
      <mass value="1.0"/>
      <origin xyz = "0 -0.001 0.01 " rpy = " 0 0 0"/>
      <inertia ixx="0.0027" iyy="0.0027" izz="0.005" ixy="0" ixz="0" iyz="0"/>
    </inertial>
  </link>

  <joint name="fixed" type="fixed">
    <parent link="world"/>
    <child link="base"/>
  </joint>

  <joint name="joint1_to_base" type="revolute">
    <axis xyz="0 0 1"/>
    <limit effort = "1000.0" lower = "-2.824" upper = "2.824" velocity = "1.0"/>
    <parent link="base"/>
    <child link="link1"/>
    <origin xyz= "0 0 0.12" rpy = "0 0 0"/>  
  </joint>


  <joint name="joint2_to_joint1" type="revolute">
    <axis xyz="0 0 1"/>
    <limit effort = "1000.0" lower = "-0.0349" upper = "1.5708" velocity = "1.0"/>
    <parent link="link1"/>
    <child link="link2"/>
    <origin xyz= "0 0 0.0" rpy = " -1.5707963 0 0 "/>  
  </joint>


  <joint name="joint3_to_joint2" type="revolute">
    <axis xyz=" 0 0 1"/>
    <limit effort = "1000.0" lower = "-1.6057" upper = "1.0471" velocity = "1.0"/>
    <parent link="link2"/>
    <child link="link3"/>
    <origin xyz= "0.0 -0.14 0   " rpy = "0 0 0 "/>  
  </joint>

  <joint name="joint4_to_joint3" type="revolute"> <!-- type="fixed"> -->
    <axis xyz=" 0 0 1"/>
    <limit effort = "1000.0" lower = "-1.5707963" upper = "1.5707963" velocity = "1.0"/>
    <parent link="link3"/>
    <child link="link4"/>
    <origin xyz= "0.134 -0.005   0.0" rpy = "3.1415926 0 0 "/>  
  </joint>

  <joint name="joint5_to_joint4" type="revolute">
    <axis xyz="0 0 1"/>
    <limit effort = "1000.0" lower = "-3.14" upper = "3.14" velocity = "1.0"/>
    <parent link="link4"/>
    <child link="link5"/>
    <origin xyz= " 0.044 0 0" rpy = "  1.5707963 0 0 "/>  
    <!-- <origin xyz= " 0.178 0 -0.005" rpy = "  -1.5707963 0 0 "/>   -->
  </joint>

  <!--トランスミッションの追加-->
  <transmission name="tran0">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint1_to_base">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor0">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <transmission name="tran1">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint2_to_joint1">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor1">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <transmission name="tran2">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint3_to_joint2">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor2">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <transmission name="tran3">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint4_to_joint3">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor3">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>
  <transmission name="tran4">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="joint5_to_joint4">
      <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor4">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <!-- ros2_control -->
  <ros2_control name="GazeboSystem" type="system">
    <hardware>
      <plugin>gz_ros2_control/GazeboSimSystem</plugin>
    </hardware>
  </ros2_control>

  <gazebo>
    <plugin
      filename="gz-sim-joint-state-publisher-system"
      name="gz::sim::systems::JointStatePublisher">
    </plugin>
  </gazebo>
  <gazebo>
    <plugin
      filename="gz-sim-joint-trajectory-controller-system"
      name="gz::sim::systems::JointTrajectoryController">
      <joint_name>joint1_to_base</joint_name>
      <initial_position>0.0</initial_position>
      <position_p_gain>20</position_p_gain>
      <position_i_gain>0.4</position_i_gain>
      <position_d_gain>1.0</position_d_gain>
      <position_i_min>-1</position_i_min>
      <position_i_max>1</position_i_max>
      <position_cmd_min>-1</position_cmd_min>
      <position_cmd_max>1</position_cmd_max>
      <position_cmd_offset>0</position_cmd_offset>

      <joint_name>joint2_to_joint1</joint_name>
      <initial_position>0.0</initial_position>
      <position_p_gain>10</position_p_gain>
      <position_i_gain>0.2</position_i_gain>
      <position_d_gain>0.5</position_d_gain>
      <position_i_min>-1</position_i_min>
      <position_i_max>1</position_i_max>
      <position_cmd_min>-1</position_cmd_min>
      <position_cmd_max>1</position_cmd_max>
      <position_cmd_offset>0</position_cmd_offset>

      <joint_name>joint3_to_joint2</joint_name>
      <initial_position>0.0</initial_position>
      <position_p_gain>10</position_p_gain>
      <position_i_gain>0.2</position_i_gain>
      <position_d_gain>0.5</position_d_gain>
      <position_i_min>-1</position_i_min>
      <position_i_max>1</position_i_max>
      <position_cmd_min>-1</position_cmd_min>
      <position_cmd_max>1</position_cmd_max>
      <position_cmd_offset>0</position_cmd_offset>

      <joint_name>joint4_to_joint3</joint_name>
      <initial_position>0.0</initial_position>
      <position_p_gain>10</position_p_gain>
      <position_i_gain>0.2</position_i_gain>
      <position_d_gain>0.5</position_d_gain>
      <position_i_min>-1</position_i_min>
      <position_i_max>1</position_i_max>
      <position_cmd_min>-1</position_cmd_min>
      <position_cmd_max>1</position_cmd_max>
      <position_cmd_offset>0</position_cmd_offset>

      <!-- Gazebo側が軌道メッセージを受け取るトピック名 -->
      <topic>arm_trajectory</topic>
    </plugin>
  </gazebo>
  <gazebo>
    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>joint1_to_base</joint_name>
      <initial_velocity>0.0</initial_velocity>
      <p_gain>50</p_gain>
      <i_gain>0.1</i_gain>
      <d_gain>2.0</d_gain>
      <i_max>1</i_max>
      <i_min>-1</i_min>
      <cmd_max>1000</cmd_max>
      <cmd_min>-1000</cmd_min>
      <topic>joint1_position_cmd</topic>
    </plugin>

    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>joint2_to_joint1</joint_name>
      <initial_velocity>0.0</initial_velocity>
      <p_gain>50</p_gain>
      <i_gain>0.1</i_gain>
      <d_gain>2.0</d_gain>
      <i_max>1</i_max>
      <i_min>-1</i_min>
      <cmd_max>1000</cmd_max>
      <cmd_min>-1000</cmd_min>
      <topic>joint2_position_cmd</topic>
    </plugin>

    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>joint3_to_joint2</joint_name>
      <initial_velocity>0.0</initial_velocity>
      <p_gain>50</p_gain>
      <i_gain>0.1</i_gain>
      <d_gain>2.0</d_gain>
      <i_max>1</i_max>
      <i_min>-1</i_min>
      <cmd_max>1000</cmd_max>
      <cmd_min>-1000</cmd_min>
      <topic>joint3_position_cmd</topic>
    </plugin>

    <plugin filename="gz-sim-joint-position-controller-system"
            name="gz::sim::systems::JointPositionController">
      <joint_name>joint4_to_joint3</joint_name>
      <initial_velocity>0.0</initial_velocity>
      <p_gain>50</p_gain>
      <i_gain>0.1</i_gain>
      <d_gain>2.0</d_gain>
      <i_max>1</i_max>
      <i_min>-1</i_min>
      <cmd_max>1000</cmd_max>
      <cmd_min>-1000</cmd_min>
      <topic>joint4_position_cmd</topic>
    </plugin>
  </gazebo>
</robot>
